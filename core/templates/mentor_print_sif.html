{% extends "base.html" %}
{% block content %}

<h4>PRINT SIF - {{ mentor.name }}</h4>
<div class="mb-3">
<a href="/mentor-prefilled-sif-all/" class="btn btn-sm btn-success">Download All Pre-filled SIF (ZIP)</a>
</div>

<input type="text" id="search" class="form-control mb-3" placeholder="Search student...">

<div class="table-responsive">
<table class="table table-hover" id="studentTable">
<thead>
<tr>
<th>Roll</th>
<th>Name</th>
<th>Mentor</th>
<th>Student Contact</th>
<th>Father Contact</th>
<th>Print</th>
<th>Pre-filled SIF</th>
</tr>
</thead>

<tbody>
{% for s in students %}
<tr>
<td>{{ s.roll_no }}</td>
<td>{{ s.name }}</td>
<td>{{ s.mentor.name }}</td>
<td>
<input class="form-control form-control-sm edit"
data-enroll="{{ s.enrollment }}"
data-field="student"
value="{{ s.student_mobile }}">
</td>
<td>
<input class="form-control form-control-sm edit"
data-enroll="{{ s.enrollment }}"
data-field="father"
value="{{ s.father_mobile }}">
</td>
<td>
<a target="_blank" href="/print-student/{{ s.enrollment }}/" class="btn btn-sm btn-lj">Print</a>
</td>
<td>
<a href="/mentor-prefilled-sif/{{ s.enrollment }}/" class="btn btn-sm btn-primary">Download Pre-filled SIF</a>
</td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

<script>
document.getElementById("search").onkeyup = function () {
    let val = this.value.toLowerCase();
    document.querySelectorAll("#studentTable tbody tr").forEach(r => {
        r.style.display = r.innerText.toLowerCase().includes(val) ? "" : "none";
    });
};

document.querySelectorAll(".edit").forEach(input => {
    input.addEventListener("change", function () {
        fetch("/update-mobile/", {
            method: "POST",
            headers: { "X-CSRFToken": "{{ csrf_token }}" },
            body: new URLSearchParams({
                enrollment: this.dataset.enroll,
                field: this.dataset.field,
                value: this.value
            })
        })
        .then(r => r.json())
        .then(() => {
            this.style.background = "#d4edda";
            setTimeout(() => this.style.background = "", 800);
        });
    });
});
</script>

{% endblock %}

